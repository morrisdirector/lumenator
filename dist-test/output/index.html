<!DOCTYPE html><html><head><title>Lumenator</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=0"><link rel="icon" href="data:,"><link rel="stylesheet" type="text/css" href="/style.css"></head><body> <ui-loader id="loader"></ui-loader> <div id="lumenator-web-app"> <header> <div class="header-container"> <div class="header-items"> <h2>Lumenator</h2> <ui-chip id="title-chip" text="test"></ui-chip> <div class="version">v1.0</div> </div> </div> </header> <nav id="nav-menu"> <nav-menu> <nav-menu-li id="1" active="">Control</nav-menu-li> <nav-menu-li id="2">Device</nav-menu-li> <nav-menu-li id="3">Network</nav-menu-li> </nav-menu> </nav> <main> <alert-message id="info-messages" type="info" closable="true"></alert-message> <alert-message id="error-messages" type="alert" closable="true"></alert-message> <div id="panel-1" class="active panel"> <section> <div class="grid-large"> <div class="form-group"> <label for="modeRgb">RGB Mode</label> <toggle-switch id="modeRgb" class="mode-toggle"></toggle-switch> <div class="color-picker"> <div><canvas id="control-color-picker"></canvas></div> </div> <alert-message id="rgb-warning" icon="info"> </alert-message> </div> <div class="form-group"> <label for="modeWhite">White Mode</label> <toggle-switch id="modeWhite" class="mode-toggle"></toggle-switch> <ui-color-slider id="whiteSlider"></ui-color-slider> </div> </div> </section> </div> <div id="panel-2" class="hidden panel"> <section> <div class="grid-large"> <div class="form-group"> <label for="name">Device Name</label> <text-input id="name"></text-input> </div> <div class="form-group"> <label for="map_preset">Device Preset</label> <dropdown-menu id="map_preset"> <option value="" class="placeholder" disabled selected>Select a device preset </option> <option value="" class="placeholder" disabled>---------------------------</option> <option value="custom">Custom Configuration</option> <option value="" class="placeholder" disabled>---------------------------</option> <option value="wemos">Wemos D1 Mini</option> </dropdown-menu> </div> </div> </section> <section> <h4>Configuration</h4> <div class="grid-large"> <div class="form-group"> <label for="name">Device Type</label> <dropdown-menu id="device_type"> <option value="" class="placeholder" disabled selected>Select a device type</option> <option value="" class="placeholder" disabled>---------------------------</option> <option value="0">RGBWW (RGB w/ Cool / Warm White)</option> <option value="1">RGBW (RGB w/ White)</option> <option value="2">RGB</option> </dropdown-menu> </div> </div> <hr> <h4>GPIO Mapping</h4> <div class="grid-large"> <div> <table> <tr class="header-row"> <th>Channel</th> <th>GPIO</th> <th>Test</th> </tr> <tr> <td>Red</td> <td> <text-input id="gpio_r" type="number"></text-input> </td> <td> <toggle-switch id="ctrl-r" class="mode-toggle"></toggle-switch> </td> </tr> <tr> <td>Green</td> <td> <text-input id="gpio_g" type="number"></text-input> </td> <td> <toggle-switch id="ctrl-g" class="mode-toggle"></toggle-switch> </td> </tr> <tr> <td>Blue</td> <td> <text-input id="gpio_b" type="number"></text-input> </td> <td> <toggle-switch id="ctrl-b" class="mode-toggle"></toggle-switch> </td> </tr> <tr> <td>Cool White</td> <td> <text-input id="gpio_w" type="number"></text-input> </td> <td> <toggle-switch id="ctrl-w" class="mode-toggle"></toggle-switch> </td> </tr> <tr> <td>Warm White</td> <td> <text-input id="gpio_ww" type="number"></text-input> </td> <td> <toggle-switch id="ctrl-ww" class="mode-toggle"></toggle-switch> </td> </tr> </table> <alert-message id="gpio-test-warning" icon="info"> </alert-message> </div> </div> </section> <div class="page-action-buttons"> <button class="primary" onclick="saveConfiguration()">Save Configuration</button> </div> </div> <div id="panel-3" class="hidden panel"> <section> <div class="grid-large"> <div class="form-group"> <label for="ssid">SSID</label> <text-input id="ssid"></text-input> </div> <div class="form-group"> <label for="password">Password</label> <text-input id="password" type="password"> <button id="show-password-button" onclick="showPassword()">Show</button> </text-input> </div> </div> </section> <div class="page-action-buttons"> <button class="primary" onclick="saveConfiguration()">Save Configuration</button> </div> </div> </main> </div> <script>!function(){function t(i){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(i)}
/**
 * @category  html5 widgets
 * @package   Kelly
 * @author    Rubchuk Vladimir <torrenttvi@gmail.com>
 * @copyright 2015-2020 Rubchuk Vladimir
 * @license   GPLv3
 * @version   1.21
 *
 * Usage example :
 *
 *   new KellyColorPicker({place : 'color-picker'});
 *
 * ToDo :
 * 
 * Add switch color in colorsavers button (analog of X button in Photoshop)
 * updateConfig method
 *
 **/function i(e){var s,a=Math.PI,o=!0,h=new Object;h.radius=4;var n=!1,r=!1,l="quad",u=!1,c=!1,p=!0,d=new Array,g=new Array,v=document.createElement("canvas"),y=!1,f=!1,m=null,x=!1,w=!0,b="mixed",S=new Object;S.tag=!1,S.margin=6;var z,D,_,C,M=!1,k=this,T=200,P="#000000",I=1,W=!1,E=!1,R=new Array,A=!1,B=new Array;function U(t,i,e){i=!!i;var s=new Object;s.width,s.widthPercentage=22,s.imageData=null,s.align=t,s.selected=i,s.color="#ffffff",s.position,s.paddingY=-4,s.paddingX=4,s.lineWidth=1,s.selectSize=4,"right"==t&&(s.paddingX=-1*s.paddingX),s.selected&&(s.color=P),e&&(s.color=e),s.updateSize=function(){this.width=parseInt(T-T/100*(100-this.widthPercentage)),"left"==this.align?this.position={x:0,y:T-this.width}:"right"==this.align&&(this.position={x:T-this.width,y:T-this.width})},s.calcS=function(t){return Math.abs((t[1].x-t[0].x)*(t[2].y-t[0].y)-(t[2].x-t[0].x)*(t[1].y-t[0].y))/2},s.isDotIn=function(t){var i=new Array;"left"==this.align?(i[0]={x:this.position.x,y:this.position.y},i[1]={x:this.position.x,y:this.position.y+this.width},i[2]={x:this.position.x+this.width,y:this.position.y+this.width}):(i[0]={x:this.position.x+this.width,y:this.position.y},i[1]={x:i[0].x,y:i[0].y+this.width},i[2]={x:i[0].x-this.width,y:this.position.y+this.width});for(var e=0;e<=i.length-1;++e)i[e].x+=this.paddingX,i[e].y+=this.paddingY;var s=this.calcS(i),a=[{x:i[0].x,y:i[0].y},{x:i[1].x,y:i[1].y},{x:t.x,y:t.y}],o=this.calcS(a);return a[1]={x:i[2].x,y:i[2].y},o+=this.calcS(a),a[0]={x:i[1].x,y:i[1].y},o+=this.calcS(a),Math.ceil(o)==Math.ceil(s)},s.draw=function(){v.width=this.width,v.height=this.width,y.clearRect(0,0,this.width,this.width),y.beginPath(),"left"==this.align&&(y.moveTo(this.lineWidth/2,this.width-this.lineWidth),y.lineTo(this.width,this.width-this.lineWidth),y.lineTo(this.lineWidth,this.lineWidth),y.lineTo(this.lineWidth,this.width-this.lineWidth)),"right"==this.align&&(y.moveTo(this.lineWidth/2,this.width-this.lineWidth),y.lineTo(this.width-this.lineWidth,this.width-this.lineWidth),y.lineTo(this.width-this.lineWidth,this.lineWidth),y.lineTo(this.lineWidth,this.width-this.lineWidth)),this.selected&&(y.fillStyle="rgba(255,255,255, 1)",y.fill(),y.strokeStyle="rgba(0, 0, 0, 1)",y.stroke(),y.closePath(),y.beginPath(),y.lineWidth=this.lineWidth,"left"==this.align&&(y.moveTo(this.selectSize,this.width-this.selectSize),y.lineTo(this.width-2*this.selectSize,this.width-this.selectSize),y.lineTo(this.selectSize,2*this.selectSize),y.lineTo(this.selectSize,this.width-this.selectSize)),"right"==this.align&&(y.moveTo(2*this.selectSize,this.width-this.selectSize),y.lineTo(this.width-this.selectSize,this.width-this.selectSize),y.lineTo(this.width-this.selectSize,2*this.selectSize),y.lineTo(2*this.selectSize,this.width-this.selectSize)));var t=J(this.color);y.fillStyle="rgba("+t.r+","+t.g+","+t.b+", 1)",y.fill(),y.strokeStyle="rgba(0, 0, 0, 1)",y.stroke(),this.imageData=y.getImageData(0,0,this.width,this.width),r.drawImage(v,this.position.x+this.paddingX,this.position.y+this.paddingY)};var a=R.length;R[a]=s}var F=new Object;F.width=18,F.imageData=null,F.innerRadius,F.startAngle=0,F.outerRadius,F.outerStrokeStyle="rgba(0,0,0,0.2)",F.innerStrokeStyle="rgba(0,0,0,0.2)",F.pos,F.draw=function(){if(this.imageData)r.putImageData(this.imageData,0,0);else{for(var t=this.startAngle,i=0;i<=360;i++){var e=Z(i-2),s=Z(i);r.beginPath(),r.moveTo(D,D),r.arc(D,D,this.outerRadius,e,s,!1),r.closePath();var o=V(t/360,1,1);r.fillStyle="rgb("+o.r+", "+o.g+", "+o.b+")",r.fill(),++t>=360&&(t=0)}r.globalCompositeOperation="destination-out",r.beginPath(),r.arc(D,D,this.innerRadius,0,2*a),r.fill(),r.globalCompositeOperation="source-over",r.strokeStyle=this.innerStrokeStyle,r.lineWidth=2,r.stroke(),r.closePath(),r.beginPath(),r.arc(D,D,this.outerRadius,0,2*a),r.strokeStyle=this.outerStrokeStyle,r.lineWidth=2,r.stroke(),r.closePath(),this.imageData=r.getImageData(0,0,T,T)}},F.isDotIn=function(t){return Math.pow(this.pos.x-t.x,2)+Math.pow(this.pos.y-t.y,2)<Math.pow(this.outerRadius,2)&&Math.pow(this.pos.x-t.x,2)+Math.pow(this.pos.y-t.y,2)>Math.pow(this.innerRadius,2)};var q=new Object;q.lineWeight=2,q.height=4,q.paddingX=2,q.path;var X=new Object;X.width=18,X.padding=4,X.outerStrokeStyle="rgba(0,0,0,0.2)",X.innerStrokeStyle="rgba(0,0,0,0.2)",X.height,X.pos,X.updateSize=function(){this.pos={x:T+X.padding,y:X.padding},this.height=T-2*X.padding},X.draw=function(){var t=r.createLinearGradient(0,0,0,this.height),i=V(_.h,1,1);t.addColorStop(0,"rgba("+i.r+","+i.g+","+i.b+",1)"),t.addColorStop(1,"rgba("+i.r+","+i.g+","+i.b+",0)"),r.beginPath(),r.rect(this.pos.x,this.pos.y,this.width,this.height),r.fillStyle="white",r.fill(),r.fillStyle=t,r.fill(),r.strokeStyle="rgba(0,0,0, 0.2)",r.lineWidth=2,r.stroke(),r.closePath()},X.dotToAlpha=function(t){return 1-Math.abs(this.pos.y-t.y)/this.height},X.alphaToDot=function(t){return{x:0,y:this.height-this.height*t}},X.limitDotPosition=function(t){var i=t.y;return i<this.pos.y&&(i=this.pos.y),i>this.pos.y+this.height&&(i=this.pos.y+this.height),{x:this.pos.x,y:i}},X.isDotIn=function(t){return!(t.x<this.pos.x||t.x>this.pos.x+X.width||t.y<this.pos.y||t.y>this.pos.y+this.height)};var L=new Object;function O(t){var i=t.getBoundingClientRect(),e=0,s=0;return u&&(s=X.width+2*X.padding),t===n?i.width<=i.height?e=i.height:i.height<i.width&&(e=i.width):E?"height"==E?e=i.height:"width"==E&&(e=i.width):i.width>i.height?e=i.height:i.height>=i.width&&(e=i.width),e=parseInt(e),u&&(e-=s),!(e<=0)&&e}function j(i,e){var s=1,a=!1;if("string"==typeof i){if(-1==(i=i.trim(i)).indexOf("(")){if("#"==i.charAt(0)&&(i=i.slice(1)),(i=i.substr(0,8)).length>=3){if(i.length>6&&i.length<8&&(i=i.substr(0,6)),i.length>3&&i.length<6&&(i=i.substr(0,3)),a=i,i.length>=3&&i.length<=4){a="";for(var o=0;o<i.length;o++)a+=i[o]+i[o]}8==a.length&&(s=(255&parseInt(a,16))/255)}}else if(vals=i.split(","),vals.length>=3){switch(i.substring(0,3)){case"rgb":vals[0]=vals[0].replace("rgba(",""),vals[0]=vals[0].replace("rgb(","");var h={r:parseInt(vals[0]),g:parseInt(vals[1]),b:parseInt(vals[2])};h.r<=255&&h.g<=255&&h.b<=255&&(a=Q(h));break;case"hsl":vals[0]=vals[0].replace("hsl(",""),vals[0]=vals[0].replace("hsla(","");var n=parseFloat(vals[0])/360,r=parseFloat(vals[1])/100,l=parseFloat(vals[2])/100;n>=0&&r<=1&&l<=1&&(a=Q(V(n,r,l)))}4==vals.length&&((!(s=parseFloat(vals[3]))||s<0)&&(s=0),s>1&&(s=1))}}else"object"==t(i)&&(void 0!==i.r&&void 0!==i.g&&void 0!==i.b?a=Q(i):void 0!==i.h&&void 0!==i.s&&void 0!==i.l&&(i.h=parseFloat(i.h)/360,i.s=parseFloat(i.s)/100,i.l=parseFloat(i.l)/100,i.h>=0&&i.s<=1&&i.l<=1&&(a=Q(V(i.h,i.s,i.l)))),void 0!==i.a&&(s=i.a));return(!1!==a||!e)&&(!1===a&&(a="000000"),{h:a="#"!=a.charAt(0)?"#"+(a=a.substr(0,6)):a.substr(0,7),a:s})}function H(){if(B.quad)return B.quad;var t=new Object;return t.size,t.padding=2,t.path,t.imageData=null,t.dotToSv=function(t){return{s:Math.abs(this.path[3].x-t.x)/this.size,v:Math.abs(this.path[3].y-t.y)/this.size}},t.svToDot=function(t){var i=this.path[0].x,e=this.path[0].y,s=.02;T<150?s=.07:T<100&&(s=.16);for(var a=0;a<this.size;a++)for(var o=0;o<this.size;o++){var h={x:o+i,y:a+e},n=this.dotToSv(h),r=Math.abs(n.s-t.s),l=Math.abs(n.v-t.v);if(r<s&&l<s)return h}return{x:0,y:0}},t.limitDotPosition=function(t){var i=t.x,e=t.y;return i<this.path[0].x&&(i=this.path[0].x),i>this.path[0].x+this.size&&(i=this.path[0].x+this.size),e<this.path[0].y&&(e=this.path[0].y),e>this.path[0].y+this.size&&(e=this.path[0].y+this.size),{x:i,y:e}},t.draw=function(){this.imageData||(this.imageData=r.createImageData(this.size,this.size));for(var t=0,i=this.path[0].x,e=this.path[0].y,s=0;s<this.size;s++)for(var a=0;a<this.size;a++){var o={x:a+i,y:s+e},h=this.dotToSv(o),n=V(_.h,h.s,h.v);this.imageData.data[t+0]=n.r,this.imageData.data[t+1]=n.g,this.imageData.data[t+2]=n.b,this.imageData.data[t+3]=255,t+=4}r.putImageData(this.imageData,i,e),r.beginPath(),r.strokeStyle="rgba(0,0,0, 0.2)",r.lineWidth=2;for(t=0;t<=this.path.length-1;++t)0==t?r.moveTo(this.path[t].x,this.path[t].y):r.lineTo(this.path[t].x,this.path[t].y);r.stroke(),r.closePath()},t.updateSize=function(){var t=2*F.innerRadius-2*q.paddingX-2*this.padding;this.size=Math.floor(t/Math.sqrt(2)),this.path=new Array,this.path[0]={x:this.size/2*-1,y:this.size/2*-1},this.path[1]={x:this.path[0].x+this.size,y:this.path[0].y},this.path[2]={x:this.path[1].x,y:this.path[1].y+this.size},this.path[3]={x:this.path[2].x-this.size,y:this.path[2].y},this.path[4]={x:this.path[0].x,y:this.path[0].y};for(var i=0;i<=this.path.length-1;++i)this.path[i].x+=F.pos.x,this.path[i].y+=F.pos.y},t.isDotIn=function(t){return!(t.x<this.path[0].x||t.x>this.path[0].x+this.size||t.y<this.path[0].y||t.y>this.path[0].y+this.size)},B.quad=t,t}function N(){if(B.triangle)return B.triangle;var t=new Object;return t.size,t.padding=2,t.path,t.imageData=null,t.followWheel=!0,t.s,t.sOnTop=!1,t.outerRadius,t.limitDotPosition=function(t){var i=t.x,e=t.y,s=this.path[0].x,a=this.path[2].x,o=i,h=e;o=Math.min(Math.max(a,o),s);var n=(this.path[0].y-this.path[1].y)/(this.path[0].x-this.path[1].x),r=Math.ceil(this.path[1].y+n*(o-this.path[1].x));n=(this.path[0].y-this.path[2].y)/(this.path[0].x-this.path[2].x);var l=Math.floor(this.path[2].y+n*(o-this.path[2].x));return i<a&&((F.pos.y-e)/(F.pos.x-i),h=e),{x:o,y:h=Math.min(Math.max(r,h),l)}},t.svToDot=function(t){var i=.02;T<150?i=.07:T<100&&(i=.16);for(var e=0;e<this.size;e++)for(var a=0;a<this.size;a++){var o={x:this.path[1].x+a,y:this.path[1].y+e};if(s.isDotIn(o)){var h=this.dotToSv(o),n=Math.abs(h.s-t.s),r=Math.abs(h.v-t.v);if(n<i&&r<i)return o}}return{x:0,y:0}},t.draw=function(){this.imageData||(this.imageData=y.createImageData(this.size,this.size)),v.width=this.size,v.height=this.size;for(var t=this.path[1].x,i=this.path[1].y,e=0,a=0;a<this.size;a++)for(var o=0;o<this.size;o++){var h={x:this.path[1].x+o,y:this.path[1].y+a};if(s.isDotIn(h)){var n=this.dotToSv(h),l=V(_.h,n.s,n.v);this.imageData.data[e+0]=l.r,this.imageData.data[e+1]=l.g,this.imageData.data[e+2]=l.b,this.imageData.data[e+3]=255}else this.imageData.data[e+0]=0,this.imageData.data[e+1]=0,this.imageData.data[e+2]=0,this.imageData.data[e+3]=0;e+=4}y.putImageData(this.imageData,0,0),r.drawImage(v,t,i),r.beginPath(),r.strokeStyle="rgba(0, 0, 0, 0.3)",r.lineWidth=2;var u=this.path;for(e=0;e<=u.length-1;++e)0==e?r.moveTo(u[e].x,u[e].y):r.lineTo(u[e].x,u[e].y);r.stroke(),r.closePath()},t.calcS=function(t){return Math.abs((t[1].x-t[0].x)*(t[2].y-t[0].y)-(t[2].x-t[0].x)*(t[1].y-t[0].y))/2},t.dotToSv=function(t){var i,e,s=function(t,i){var e=(i[0].x-i[1].x)*(i[0].x-i[1].x)+(i[0].y-i[1].y)*(i[0].y-i[1].y),s=(t.x-i[0].x)*(i[1].x-i[0].x)+(t.y-i[0].y)*(i[1].y-i[0].y),a=!0,o=s/e;o<0&&(o=0,a=!1);o>1&&(o=1,a=!1);return{x:i[0].x+o*(i[1].x-i[0].x),y:i[0].y+o*(i[1].y-i[0].y),pt:a}}({x:t.x,y:t.y},this.vol),a=(i=s,e=this.vol[0],Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)));a<1&&(a=Math.floor(a)),a>this.h-1&&(a=this.h);var o=a/this.h,h=Math.abs(tt(t,this.sSide));return h<30&&(h=30),h=60-(h-=30),{s:h/=60,v:o}},t.isDotIn=function(t){var i=[{x:this.path[0].x,y:this.path[0].y},{x:this.path[1].x,y:this.path[1].y},{x:t.x,y:t.y}],e=this.calcS(i);return i[1]={x:this.path[2].x,y:this.path[2].y},e+=this.calcS(i),i[0]={x:this.path[1].x,y:this.path[1].y},e+=this.calcS(i),Math.ceil(e)==Math.ceil(this.s)},t.updateSize=function(){this.outerRadius=F.innerRadius-q.paddingX-this.padding,this.size=Math.floor(2*this.outerRadius*Math.sin(Z(60)));var t=Math.sqrt(3)/2*this.size;this.h=Math.sqrt(3)/2*this.size,this.path=new Array,this.path[0]={x:this.outerRadius,y:0},this.path[1]={x:this.path[0].x-t,y:this.size/2*-1},this.path[2]={x:this.path[1].x,y:this.size/2},this.path[3]={x:this.path[0].x,y:this.path[0].y};for(var i=0;i<=this.path.length-1;++i)this.path[i].x+=F.pos.x,this.path[i].y+=F.pos.y;if(this.vol=new Array,this.s=this.calcS(this.path),this.sOnTop){var e=$(this.path[0],this.path[2]);this.vol[0]={x:this.path[1].x,y:this.path[1].y},this.vol[1]={x:e.x,y:e.y},this.sSide=this.path[1]}else{e=$(this.path[0],this.path[1]);this.vol[0]={x:this.path[2].x,y:this.path[2].y},this.vol[1]={x:e.x,y:e.y},this.sSide=this.path[2]}},B.triangle=t,t}function Y(i,e,s,a){return"object"!==t(i)&&(i=document.getElementById(i)),!!i&&(a||(a=""),d[a+e]=s,i.addEventListener?i.addEventListener(e,d[a+e]):i.attachEvent("on"+e,d[a+e]),!0)}function G(i,e,s){return"object"!==t(i)&&(i=document.getElementById(i)),!!i&&(s||(s=""),!!d[s+e]&&(i.removeEventListener?i.removeEventListener(e,d[s+e]):i.detachEvent("on"+e,d[s+e]),d[s+e]=null,!0))}function V(t,i,e){var s,a,o,h,n,r,l,u;switch(t&&void 0===i&&void 0===e&&(i=t.s,e=t.v,t=t.h),r=e*(1-i),l=e*(1-(n=6*t-(h=Math.floor(6*t)))*i),u=e*(1-(1-n)*i),h%6){case 0:s=e,a=u,o=r;break;case 1:s=l,a=e,o=r;break;case 2:s=r,a=e,o=u;break;case 3:s=r,a=l,o=e;break;case 4:s=u,a=r,o=e;break;case 5:s=e,a=r,o=l}return{r:Math.floor(255*s),g:Math.floor(255*a),b:Math.floor(255*o)}}function K(t,i,e){t&&void 0===i&&void 0===e&&(i=t.g,e=t.b,t=t.r),t/=255,i/=255,e/=255;var s,a,o=Math.max(t,i,e),h=Math.min(t,i,e),n=o,r=o-h;if(a=0==o?0:r/o,o==h)s=0;else{switch(o){case t:s=(i-e)/r+(i<e?6:0);break;case i:s=(e-t)/r+2;break;case e:s=(t-i)/r+4}s/=6}return{h:s,s:a,v:n}}function J(t){var i=parseInt("#"==t.charAt(0)?t.slice(1):t,16);return{r:i>>16,g:i>>8&255,b:255&i}}function Q(t){var i=function(t){var i=t.toString(16);return 1===i.length?"0"+i:i};return"#"+i(t.r)+i(t.g)+i(t.b)}function Z(t){return t*(a/180)}function $(t,i){return{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}function tt(t,i,e){i||(i={x:0,y:0});var s=t.x-i.x,o=t.y-i.y,h=180*Math.atan2(o,s)/a;return e&&h<0&&(h=360+h),h}function it(){z=2+q.paddingX,f=!1,F.imageData=null,D=T/2,F.pos={x:D,y:D},F.outerRadius=D-z,F.innerRadius=F.outerRadius-F.width,q.path=[{x:F.innerRadius-q.paddingX,y:-1*q.height},{x:F.outerRadius+q.paddingX,y:-1*q.height},{x:F.outerRadius+q.paddingX,y:q.height},{x:F.innerRadius-q.paddingX,y:q.height},{x:F.innerRadius-q.paddingX,y:-1*(q.height+q.lineWeight/2)}];var t=T;u&&(t+=X.width+2*X.padding),"canvas"!=M.tagName.toLowerCase()&&(M.style.width=t+"px",M.style.height=T+"px"),n.width=t,n.height=T,W!=n&&(n.style.width=t+"px",n.style.height=T+"px");for(var i=0;i<=R.length-1;++i)R[i].updateSize();A&&(A.imageData.triangle=null,A.imageData.quad=null,A.updateSize()),s.updateSize(),u&&X.updateSize()}function et(t){if(x){if(g.updateinput)if(!(0,g.updateinput)(k,x,t))return;var i=I.toFixed(2),e="rgba("+C.r+", "+C.g+", "+C.b+", "+i+")";if(!t)switch(b){case"mixed":x.value=I<1?e:P;break;case"hex":x.value=P;break;case"hsla":x.value="hsla("+(360*_.h).toFixed(2)+", "+(100*_.s).toFixed(2)+"%, "+(100*_.v).toFixed(2)+"%, "+i+")";break;default:x.value=e}w&&(_.v<.5?x.style.color="#FFF":x.style.color="#000",x.style.background=e)}}function st(){Y(n,"mousedown",(function(t){k.mouseDownEvent(t)}),"wait_action_"),Y(n,"touchstart",(function(t){k.mouseDownEvent(t)}),"wait_action_"),Y(n,"mouseout",(function(t){k.mouseOutEvent(t)}),"wait_action_"),Y(window,"touchmove",(function(t){k.touchMoveEvent(t)}),"wait_action_"),Y(n,"mousemove",(function(t){k.mouseMoveRest(t)}),"wait_action_")}function at(){G(n,"mousedown","wait_action_"),G(n,"touchstart","wait_action_"),G(n,"mouseout","wait_action_"),G(window,"touchmove","wait_action_"),G(n,"mousemove","wait_action_")}function ot(t){var i,e;t=t||window.event;var s=document.body.scrollLeft+document.documentElement.scrollLeft,a=document.body.scrollTop+document.documentElement.scrollTop;"touchend"==t.type?(i=t.changedTouches[0].clientX+s,e=t.changedTouches[0].clientY+a):"touchmove"==t.type||t.touches?(i=t.touches[0].clientX+s,e=t.touches[0].clientY+a):(i=t.clientX+s,e=t.clientY+a);var o=n.getBoundingClientRect();return{x:i-=o.left+s,y:e-=o.top+a}}function ht(t){for(var i=!1,e=0;e<=R.length-1;++e)R[e].selected&&(i=e),R[e].selected=!1;var s=!1;for(e=0;e<=R.length-1;++e)if(e==t){R[e].selected=!0,k.setColorByHex(R[e].color),s=!0;break}s&&g.selectcolorsaver&&(0,g.selectcolorsaver)(k,R[t]);return s||!1===i||(R[i].selected=!0),s}function nt(){for(var t=0;t<=R.length-1;++t)R[t].selected&&(R[t].color=P)}function rt(){if(R.length)for(var t=0;t<=R.length-1;++t)R[t].draw()}function lt(){if(!r||(r.clearRect(0,0,n.width,n.height),!(f?(r.putImageData(m,0,0),rt(),1):(F.draw(),s.draw(),u&&X.draw(),rt(),A&&A.draw(),c||(m=r.getImageData(0,0,n.width,n.height),f=!0),1))))return!1;var t=360*_.h-F.startAngle;if(u){r.beginPath();var i=X.height*(1-I);r.rect(X.pos.x-2,X.padding+i-1,X.width+4,2),r.strokeStyle="rgba(0,0,0, 0.8)",r.lineWidth=2,r.stroke(),r.closePath()}r.beginPath();for(var e=function(t,i){i=Z(i);for(var e=new Array,s=0;s<=t.length-1;++s)e[s]={x:t[s].x*Math.cos(i)-t[s].y*Math.sin(i),y:t[s].x*Math.sin(i)+t[s].y*Math.cos(i)};return e}(q.path,t,(F.pos.x,F.pos.y)),o=0;o<=e.length-1;++o)e[o].x+=F.pos.x,e[o].y+=F.pos.y,0==o?r.moveTo(e[o].x,e[o].y):r.lineTo(e[o].x,e[o].y);return r.strokeStyle="rgba(0,0,0,0.8)",r.lineWidth=q.lineWeight,r.stroke(),r.closePath(),_.v>.5&&_.s<.5?r.strokeStyle="rgba(0, 0, 0, 1)":r.strokeStyle="rgba(255, 255, 255, 1)",r.beginPath(),r.lineWidth=2,r.arc(_.x,_.y,h.radius,0,2*a),r.stroke(),r.closePath(),!1}L.svCursorData=null,L.stCursor=null,L.curType=0,L.size=16,L.cEl=document.body,L.initSvCursor=function(){if(!n)return!1;if(this.curType=1,this.stCursor||(this.stCursor=window.getComputedStyle(this.cEl).cursor,this.stCursor||(this.stCursor="auto")),this.svCursorData)return this.cEl.style.cursor=this.svCursorData,!0;if(!v)return!1;var t=this.size+2;v.width=t,v.height=t,y.clearRect(0,0,this.size,this.size),y.strokeStyle="rgba(255, 255, 255, 1)",y.beginPath(),y.lineWidth=2,y.arc(t/2,t/2,this.size/2,0,2*a),y.stroke(),y.closePath();var i=t,e=v.toDataURL();return this.svCursorData="url("+e+") "+i/2+" "+i/2+", auto",!!this.svCursorData&&(this.cEl.style.cursor=this.svCursorData,-1===this.cEl.style.cursor.indexOf(e)&&(this.svCursorData="crosshair",this.cEl.style.cursor="crosshair"),!0)},L.initStandartCursor=function(){this.stCursor&&(L.curType=0,this.cEl.style.cursor=this.stCursor)},L.updateCursor=function(t){o&&(i.cursorLock||(s.isDotIn(t)?L.initSvCursor():L.initStandartCursor()))},this.popUpClose=function(t){if(!1!==S.tag){if(t){if(t.target==x||t.target==n)return!1;if(t.target==S.tag)return!1}g.popupclose&&!g.popupclose(k,t)||(S.tag.style.display="none",i.activePopUp==k&&(i.activePopUp=!1))}},this.popUpShow=function(t){if(!1!==S.tag&&(!g.popupshow||g.popupshow(k,t))){i.popupEventsInclude||(Y(document,"click",(function(t){return!!i.activePopUp&&i.activePopUp.popUpClose(t)}),"popup_close_"),Y(window,"resize",(function(t){if(i.activePopUp)return i.activePopUp.popUpShow(t)}),"popup_resize_"),i.popupEventsInclude=!0),i.activePopUp&&i.activePopUp.popUpClose(!1);var e=k.getCanvas().width,s=k.getAlphaFig();s&&(e-=s.width+s.padding);var a=window.getComputedStyle(S.tag),o=parseInt(a.paddingBottom)+parseInt(a.paddingTop);o<=0&&(o=0);var h=x.getBoundingClientRect(),n=h.top+(window.scrollY||window.pageYOffset||document.body.scrollTop)-o,r=h.left+(window.scrollX||window.pageXOffset||document.body.scrollLeft);return S.tag.style.top=n-e-S.margin+"px",S.tag.style.left=r+"px",S.tag.style.display="block",i.activePopUp=k,!1}},this.setHueByDot=function(t){var i=tt(t,F.pos)+F.startAngle;(i<0&&(i=360+i),_.h=i/360,C=V(_.h,_.s,_.v),P=Q(C),nt(),g.change)&&(0,g.change)(k);et(),f=!1,lt()},this.setColorForColorSaver=function(t,i){var e=j(t,!0);if(e){var s=k.getColorSaver(i);return s.selected?this.setColorByHex(t,!1):(s.color=e.h,lt()),!0}},this.setColor=function(t,i){k.setColorByHex(t,i)},this.setColorByHex=function(t,i){i||(i=!1);var e=I;if(!1!==t){if(!t||!t.length)return;var a=j(t,!0);if(!a)return;t=a.h,u&&(e=a.a)}else t=P;if(u&&t==P&&f&&e!=I)return I=e,void lt();if(!P||t!=P||!f){I=e,C=J(t),P=t,_=K(C);var o=s.svToDot(_);if(_.x=o.x,_.y=o.y,f=!1,nt(),lt(),g.change)(0,g.change)(k);et(i)}},this.setAlphaByDot=function(t){(I=X.dotToAlpha(t),g.change)&&(0,g.change)(k);et(),lt()},this.setAlpha=function(t){I=t,et(),lt()},this.setColorByDot=function(t){var i=s.dotToSv(t);(_.s=i.s,_.v=i.v,_.x=t.x,_.y=t.y,_.s>1&&(_.s=1),_.s<0&&(_.s=0),_.v>1&&(_.v=1),_.v<0&&(_.v=0),C=V(_.h,_.s,_.v),P=Q(C),nt(),g.change)&&(0,g.change)(k);et(),lt()},this.mouseOutEvent=function(t){L.curType>0&&!i.cursorLock&&L.initStandartCursor()},this.mouseMoveRest=function(t){if(!c&&p){p=!1;var i=ot(t);if(L.updateCursor(i),requestAnimationFrame((function(){p=!0})),g.mousemoverest)(0,g.mousemoverest)(t,k,i)}},this.touchMoveEvent=function(t){c&&event.preventDefault()},this.mouseDownEvent=function(t){t.preventDefault();var e,a=!1,o=ot(t);if(F.isDotIn(o))c="wheel",k.setHueByDot(o),e=function(t){k.wheelMouseMove(t,o)},a=function(t){i.cursorLock=!1,k.wheelMouseUp(t,o)};else if(s.isDotIn(o))c="sv",k.setColorByDot(o),e=function(t){k.svMouseMove(t,o)},a=function(t){i.cursorLock=!1,k.svMouseUp(t,o)};else if(u&&X.isDotIn(o))c="alpha",k.setAlphaByDot(o),e=function(t){k.alphaMouseMove(t,o)},a=function(t){i.cursorLock=!1,k.alphaMouseUp(t,o)};else if(A&&A.isDotIn(o))k.setMethod();else if(R.length)for(var h=0;h<=R.length-1;++h)if(R[h].isDotIn(o)){ht(h);break}e&&a&&(at(),i.cursorLock=k,Y(document,"mouseup",a,"action_process_"),Y(document,"mousemove",e,"action_process_"),Y(document,"touchend",a,"action_process_"),Y(document,"touchmove",e,"action_process_"))},this.wheelMouseMove=function(t,i){if(t.preventDefault(),c&&p){p=!1;var e=ot(t);if(requestAnimationFrame((function(){p=!0})),k.setHueByDot(e),g.mousemoveh)(0,g.mousemoveh)(t,k,e)}},this.wheelMouseUp=function(t,i){if(t.preventDefault(),c){G(document,"mouseup","action_process_"),G(document,"mousemove","action_process_"),G(document,"touchend","action_process_"),G(document,"touchmove","action_process_"),st(),c=!1,f=!1,lt();var e=ot(t);if(L.updateCursor(e),g.mouseuph)(0,g.mouseuph)(t,k,e)}},this.alphaMouseMove=function(t,i){if(t.preventDefault(),c&&p){p=!1;var e=ot(t);if(e=X.limitDotPosition(e),requestAnimationFrame((function(){p=!0})),k.setAlphaByDot(e),g.mousemovealpha)(0,g.mousemovealpha)(t,k,e)}},this.alphaMouseUp=function(t,i){if(t.preventDefault(),c){G(document,"mouseup","action_process_"),G(document,"mousemove","action_process_"),G(document,"touchend","action_process_"),G(document,"touchmove","action_process_"),st(),c=!1;var e=ot(t);if(L.updateCursor(e),g.mouseupalpha)(0,g.mouseupalpha)(t,k,e)}},this.svMouseMove=function(t,i){if(t.preventDefault(),c&&p){p=!1;var e=ot(t);if(e=s.limitDotPosition(e),requestAnimationFrame((function(){p=!0})),k.setColorByDot(e),g.mousemovesv)(0,g.mousemovesv)(t,k,e)}},this.svMouseUp=function(t,i){if(t.preventDefault(),c){G(document,"mouseup","action_process_"),G(document,"mousemove","action_process_"),G(document,"touchend","action_process_"),G(document,"touchmove","action_process_"),st(),c=!1;var e=ot(t);if(L.updateCursor(e),u&&(f=!1,lt()),g.mouseupsv)(0,g.mouseupsv)(t,k,e)}},this.addUserEvent=function(t,i){return g[t]=i,!0},this.removeUserEvent=function(t){return!!g[t]&&(g[t]=null,!0)},this.getCanvas=function(){return!!r&&n},this.getCtx=function(){return r||!1},this.getInput=function(){return x},this.getSvFig=function(){return s},this.getSvFigCursor=function(){return h},this.getWheel=function(){return F},this.getWheelCursor=function(){return q},this.getCurColorHsv=function(){return _},this.getCurColorRgb=function(){return C},this.getCurColorHex=function(){return P},this.getCurColorRgba=function(){return{r:C.r,g:C.g,b:C.b,a:I}},this.getCurAlpha=function(){return I},this.getAlphaFig=function(){return!!u&&X},this.getPopup=function(){return S},this.getSize=function(){return T},this.getColorSaver=function(t){for(var i=0;i<=R.length-1;++i)if(!t&&R[i].selected||R[i].align==t)return R[i].rgb=J(R[i].color),R[i].hsv=K(R[i].rgb.r,R[i].rgb.g,R[i].rgb.b),R[i]},this.setColorSaver=function(t){if(!t)return!1;for(var i=0;i<=R.length-1;++i)if(R[i].align==t)return ht(i),R[i]},this.updateView=function(t){return!!r&&(t&&(F.imageData=null,s.imageData=null,m=null),f=!1,it(),lt(),!0)},this.resize=function(t,i){return!!r&&(t==T&&!i||(f=!1,F.imageData=null,s.imageData=null,m=null,T=t,it(),k.setColorByHex(!1),!1))},this.syncSize=function(t){if(!W)return!1;var i=O(W);return i&&k.resize(i),!1},this.setMethod=function(t){if(t||(t="triangle","triangle"==l&&(t="quad")),t==l)return!1;if("quad"!=l&&"triangle"!=l)return!1;("quad"==(l=t)&&(s=H()),"triangle"==l&&(s=N()),k.resize(T,!0),g.setmethod)&&(0,g.setmethod)(k,l);return!0},this.destroy=function(){if(!k)return!1;L.curType>0&&(i.cursorLock=!1,L.initStandartCursor()),c&&(G(document,"mouseup","action_process_"),G(document,"mousemove","action_process_"),G(document,"touchend","action_process_"),G(document,"touchmove","action_process_"),c=!1),S.tag&&G(x,"click","popup_"),x&&(G(x,"click","input_edit_"),G(x,"change","input_edit_"),G(x,"keyup","input_edit_"),G(x,"keypress","input_edit_")),i.popupEventsInclude&&d.popup_close_click&&(i.activePopUp&&i.activePopUp.popUpClose(!1),G(document,"click","popup_close_"),G(window,"resize","popup_resize_"),i.popupEventsInclude=!1),F.imageData=null,s.imageData=null,m=null,v=null,M&&M.parentNode&&M.parentNode.removeChild(M),W&&G(window,"resize","canvas_"),at(),k=null},function(i){var e="",h="";if(void 0!==i.alpha_slider&&(i.alphaSlider=i.alpha_slider),void 0!==i.input_color&&(i.inputColor=i.input_color),void 0!==i.input_format&&(i.inputFormat=i.input_format),i.input&&"object"!==t(i.input)?(i.input=document.getElementById(i.input),x=i.input):"object"===t(i.input)&&(x=i.input),void 0!==i.changeCursor&&(o=i.changeCursor),void 0!==i.alpha&&(I=i.alpha),void 0!==i.alphaSlider&&(u=i.alphaSlider),void 0!==i.inputColor&&(w=i.inputColor),void 0!==i.inputFormat&&(b=i.inputFormat),i.userEvents&&(g=i.userEvents),i.place&&"object"!==t(i.place)&&(h=i.place,i.place=document.getElementById(i.place)),i.place)M=i.place;else if(x){S.tag=document.createElement("div"),S.tag.className="popup-kelly-color",i.popupClass?S.tag.className=i.popupClass:(S.tag.className="popup-kelly-color",S.tag.style.position="absolute",S.tag.style.bottom="0px",S.tag.style.left="0px",S.tag.style.display="none",S.tag.style.backgroundColor="#e1e1e1",S.tag.style.border="1px solid #bfbfbf",S.tag.style.boxShadow="7px 7px 14px -3px rgba(0,0,0,0.24)",S.tag.style.borderTopLeftRadius="4px",S.tag.style.borderTopRightRadius="4px",S.tag.style.borderBottomLeftRadius="4px",S.tag.style.borderBottomRightRadius="4px",S.tag.style.padding="12px",S.tag.style.boxSizing="content-box"),M=S.tag,document.getElementsByTagName("body")[0].appendChild(S.tag),Y(x,"click",(function(t){return k.popUpShow(t)}),"popup_")}else e+='| "place" ('+h+") not not found";var c=!1;if(i.color?c=j(i.color):x&&x.value&&(c=j(x.value)),c&&(P=c.h,u&&(I=c.a)),!i.method||"triangle"!=i.method&&"quad"!=i.method||(l=i.method),function(){if(!M)return!1;"CANVAS"!=M.tagName?(n=document.createElement("CANVAS"),M.appendChild(n)):n=M;void 0!==window.G_vmlCanvasManager&&(n=window.G_vmlCanvasManager.initElement(n),v=window.G_vmlCanvasManager.initElement(v));return!(!n.getContext||!n.getContext("2d"))&&(r=n.getContext("2d"),y=v.getContext("2d"),!0)}()||(e+=" | cant init canvas context"),i.resizeWith&&("object"!==t(i.resizeWith)&&"boolean"!=typeof i.resizeWith&&(i.resizeWith=document.getElementById(i.resizeWith)),W=!0===i.resizeWith?n:i.resizeWith,i.resizeSide&&(E=i.resizeSide),W&&(O(W)&&(i.size=O(W)),Y(window,"resize",(function(t){return k.syncSize(t)}),"canvas_"))),i.size&&i.size>0&&(T=i.size),e)"undefined"!=typeof console&&console.log("KellyColorPicker : "+e);else{if("quad"==l&&(s=H()),"triangle"==l&&(s=N()),x){var p=function(t){(t=t||window.event).target||(t.target=t.srcElement),k.setColorByHex(t.target.value,!0)};Y(x,"click",p,"input_edit_"),Y(x,"change",p,"input_edit_"),Y(x,"keyup",p,"input_edit_"),Y(x,"keypress",p,"input_edit_")}i.colorSaver&&(U("left",!0),U("right")),i.methodSwitch&&((A=new Object).size,A.sizePercentage=10,A.position,A.paddingY=4,A.paddingX=4,A.imageData=new Array,A.lineWidth=2,A.color="#c1ebf5",A.updateSize=function(){this.size=parseInt(T-T/100*(100-this.sizePercentage)),this.size<16&&(this.size=16),this.position={x:this.paddingX,y:this.paddingY}},A.draw=function(){if(this.imageData[l])r.putImageData(this.imageData[l],this.position.x,this.position.y);else{var t=J(this.color);v.width=this.size,v.height=this.size,y.clearRect(0,0,this.size,this.size),y.beginPath();var i,e="triangle";if("triangle"==l&&(e="quad"),y.beginPath(),this.size<35)var s=o=v.width/2;else{var o=v.width/2-this.lineWidth;y.arc(this.size/2,this.size/2,o,0,2*a),y.strokeStyle="rgba(0, 0, 0, 0.4)",y.lineWidth=this.lineWidth,y.stroke(),s=o-6,y.closePath(),y.beginPath(),y.arc(this.size/2,this.size/2,s,0,2*a),y.strokeStyle="rgba(0, 0, 0, 0.4)",y.lineWidth=this.lineWidth,y.stroke(),y.closePath()}if(y.beginPath(),"quad"==e){var h=2*s-4;i=Math.floor(h/Math.sqrt(2));var n=(this.size-i)/2;(u={x:n+i,y:n+i/2}).y=u.y-i/2,y.moveTo(u.x,u.y),y.lineTo(u.x-i,u.y),y.lineTo(u.x-i,u.y+i),y.lineTo(u.x,u.y+i)}else{i=Math.floor((2*s-4)*Math.sin(Z(60)));var u={x:2*s+(o-s),y:this.size/2},c=Math.sqrt(3)/2*i;y.moveTo(u.x,u.y),y.lineTo(u.x-c,u.y-i/2),y.lineTo(u.x-c,u.y+i/2),y.lineTo(u.x,u.y)}y.lineTo(u.x,u.y),y.fillStyle="rgba("+t.r+","+t.g+","+t.b+", 1)",y.fill(),y.lineWidth=this.lineWidth,y.strokeStyle="rgba(0, 0, 0, 0.6)",y.stroke(),y.closePath(),this.imageData[l]=y.getImageData(0,0,v.width,v.width),r.drawImage(v,this.position.x,this.position.y)}},A.isDotIn=function(t){return t.x>=this.position.x&&t.x<=this.position.x+this.size&&t.y>=this.position.y&&t.y<=this.position.y+this.size}),st(),it(),k.setColorByHex(!1)}}(e)}i.cursorLock=!1,i.activePopUp=!1,i.popupEventsInclude=!1,i.attachToInputByClass=function(t,e){for(var s=new Array,a=document.getElementsByClassName(t),o=0;o<a.length;o++)e?e.input=a[o]:e={input:a[o],size:150},s.push(new i(e));return s}}();</script> <script src="/lumenator.js"></script> </body></html>